<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Document</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
    <style>
        #map {
            height: 400px;
            width: 600px;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <h1>Data Selfie App</h1>


    <p>Link to <a href="index.html">index</a></p>
    <div id="map"></div>

    <script>
        let position = {
            coords: {
                latitude: 1.3795328,
                longitude: 103.8942208
            },
        };

        if ('geolocation' in navigator) {
            console.log('geolocation is available');

            navigator.geolocation.getCurrentPosition((_position) => {
                console.log(_position);
                position = _position;

            });
        } else {
            console.log('geolocation not available');
        }

        getData();
        async function getData() {
            const response = await fetch('/api');
            const json = await response.json()
            console.log(json);

            for (item of json) {
                const root = document.createElement('div');
                const mood = document.createElement('div');
                const geo = document.createElement('div');
                const date = document.createElement('div');

                mood.textContent = `mood: ${item.mood}`;
                geo.textContent = `${item.lat} ; ${item.long}`;
                const dateString = new Date(item.timestamp).toLocaleString();
                date.textContent = dateString;

                root.append(mood, geo, date);
                document.body.append(root);
                L.marker([item.lat, item.long]).addTo(map);
            }

        }
        const map = L.map('map').setView([position.coords.latitude, position.coords.longitude], 15);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18,
            // id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1
                // accessToken: process.env.map_accessToken
        }).addTo(map);
    </script>

</body>

</html>